/*jslint evil:true *//*globals METADATA LOAD_JS_FROM_PNG*/(function(){function u(){c.fillStyle=e,c.fillRect(0,0,l,m)}function v(){var a,b;for(a=0;a<h;a++){j[a]=[],k[a]=[];for(b=0;b<i;b++)j[a][b]=0,k[a][b]=0}u()}function w(a,b){var c=0,d;for(d=0;d<b.length;d++)c+=b[d];return a?c<2?0:c>3?0:1:c===3?1:0}function x(){var a,b;u(),c.fillStyle=d;for(a=0;a<h;a++)for(b=0;b<i;b++)j[a][b]&&c.fillRect(b*f,a*f,f,f)}function y(){var a,b,e;v(),c.fillStyle=d;for(a=0;a<h*i*.1;a++)b=Math.floor(Math.random()*h),e=Math.floor(Math.random()*i),j[b][e]=1;x()}function z(){var a,b,c,d,e,f,g,l,m,n,o,p,q,r,s=!1,u=!1,v=!1,y=!1,z=k;for(a=0;a<h;a++){s=a===0,u=a===h-1;for(b=0;b<i;b++)v=b===0,y=b===i-1,t?(f=a?a-1:h-1,g=a+1<h?a+1:0,c=b+1<i?b+1:0,d=b?b-1:i-1,e=j[f][b],l=j[f][c],m=j[a][c],n=j[g][c],o=j[g][b],p=j[g][d],q=j[a][d],r=j[f][d]):(e=s?0:j[a-1][b],l=s||y?0:j[a-1][b+1],m=y?0:j[a][b+1],n=u||y?0:j[a+1][b+1],o=u?0:j[a+1][b],p=u||v?0:j[a+1][b-1],q=v?0:j[a][b-1],r=s||v?0:j[a-1][b-1]),z[a][b]=w(j[a][b],[e,l,m,n,o,p,q,r])}k=j,j=z,x()}var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=100,s=100,t=!0;window.LIFE={init:function(b,g,n,o,p,q){a=document.getElementById(b),c=a&&a.getContext("2d"),d=p||"#00FF00",e=o||"#000000",l=g,m=n,f=q||1,j=[],k=[];if(!c){window.alert("unable to initialize HTML Canvas. You might want to try another browser.");return}a.setAttribute("width",l),a.setAttribute("height",m),i=Math.floor(l/f),h=Math.floor(m/f),v()},random_seed:y,start:function(){g&&clearInterval(g),g=setInterval(z,1e3/30)},step:z,stop:function(){g&&(clearInterval(g),g=null)},reset:v,insert_seed:function(a){var b,c,d,e=a.split("\n"),f=Math.floor(h/2)-Math.floor(e.length/2),g=Math.floor(i/2)-Math.floor(e[0].length/2);for(c=0;c<e.length;c++){b=e[c],b=b.trim();for(d=0;d<b.length;d++)j[c+f][d+g]=b[d]==="."?0:1}x()},loadPatterns:function(a,b){var c=new Image,d=new Image,e=document.createElement("canvas"),f=e.getContext("2d"),g=[],h="",i="",j=[],k="";n=[];var l=this;c.onload=function(){var a,b,d,j,k,m,o,p,q=[],r=c.width,t=c.height;e.setAttribute("width",r+"px"),e.setAttribute("height",t+"px"),f.drawImage(c,0,0,r,t),d=f.getImageData(0,0,r,t).data;for(a=0;a<d.length;a+=4)g.push(d[a]?".":"O");h=g.join(""),LOAD_JS_FROM_PNG("build/metadata_o.png",function(){for(b=0;b<METADATA.length;b+=4){i="",p=METADATA[b+1],j=METADATA[b+2],k=METADATA[b+3];for(m=0;m<j;m++)i+=h.substring(p+m*k,p+(m+1)*k),m<j-1&&(i+="\n");n.push({name:METADATA[b],rows:j,cols:k,data:i})}l.makeThumbnails(s,s)})},c.onerror=function(){console.log("failed to load patterns data image")},c.src="build/data_o.png"},renderPageLinks:function(){var a,b="";for(a=0;a<p;a++)b+="<a href='#' class='"+(a===q?"active":"")+"'onclick='LIFE.showPage("+a+");return false;'>"+(a+1)+"</a>\n";document.getElementById("pages_nav").innerHTML=b},makeThumbnails:function(a,c,d){function z(a){var b=0,c=0;if(a.offsetParent){do b+=a.offsetLeft,c+=a.offsetTop;while(Boolean(a=a.offsetParent));return[b,c]}}function A(a){}function B(b){var d=b.target,e=b.clientX,f=b.clientY;while(d)e-=d.offsetLeft-d.scrollLeft,f-=d.offsetTop-d.scrollTop,d=d.offsetParent;var g=Math.floor((b.target.parentNode.scrollLeft+e)/(a+s)),h=Math.floor((b.target.parentNode.scrollTop+f)/(c+s)),i=q*v*u+g*v+h;i<n.length&&y.insert_seed(n[i].data)}function C(d){var e=d.target,f=z(e),g=d.clientX-f[0],h=d.clientY-f[1];console.log(q);var i=Math.floor(g/(a+s)),j=Math.floor(h/(c+s)),k=q*v*u+i*v+j;k<n.length&&(t||(t=document.createElement("div"),t.setAttribute("class","tooltip"),document.body.appendChild(t),b.addEventListener("mouseout",function(){t.style.display="none"},!1)),t.style.display="block",t.style.left=f[0]+8+g+"px",t.style.top=f[1]+15+h+"px",t.innerHTML=n[k].name)}var e,f,h,i,j,k,l,m=document.getElementById("thumbnails"),o=m.getContext("2d"),r=n.length,s=5,t,u=Math.floor((window.innerWidth-650)/(a+s))||1,v=Math.floor(600/(c+s))||1,w=u*(a+s),x=v*(c+s);q=d===undefined?0:d,p=Math.ceil(r/(u*v)),this.renderPageLinks(),b=m,m.setAttribute("width",w+"px"),m.setAttribute("height",x+"px"),o.fillStyle="#000",o.fillRect(0,0,w,x),o.fillStyle="#CCC";for(e=0;e<v*u;e++){f=n[e+u*v*q];if(!f)break;j=a/f.cols,k=c/f.rows,k>j?k=j:j=k,l=f.data.split("\n");for(i=0;i<f.rows;i++)for(h=0;h<f.cols;h++)l[i].charAt(h)==="O"&&o.fillRect(Math.floor(e/v)*(a+s)+Math.floor(h*j),Math.floor(e%v*(c+s)+i*k),j,k)}var y=this;b.addEventListener("click",B,!1),b.addEventListener("mousemove",C,!1),document.onkeypress=function(a){console.log(a.keyCode),a.keyCode===13&&(g?y.stop():y.start()),a.keyCode===32&&y.reset()}},saveThumbnails:function(){document.write("<img src='"+b.toDataURL("image/png")+"' >")},showNext:function(){this.makeThumbnails(s,s,q<p?q+1:0)},showPrev:function(){this.makeThumbnails(s,s,q?q-1:p-1)},showPage:function(a){this.makeThumbnails(s,s,a)}}})()